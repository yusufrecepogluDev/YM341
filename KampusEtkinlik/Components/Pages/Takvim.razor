@page "/takvim"

<div class="calendar-container">
    <div class="calendar-header">
        <h1 class="calendar-title">Etkinlik Takvimi</h1>
        <p class="calendar-subtitle">Tüm kulüp etkinliklerini ve duyuruları görüntüleyin</p>
    </div>

    <!-- Ay Navigasyonu -->
    <div class="month-navigation">
        <button class="nav-btn prev-btn" @onclick="PreviousMonth">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        
        <h2 class="current-month">@currentDate.ToString("MMMM yyyy", new System.Globalization.CultureInfo("tr-TR"))</h2>
        
        <button class="nav-btn next-btn" @onclick="NextMonth">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <!-- Renk Açıklaması -->
    <div class="legend">
        <div class="legend-item">
            <span class="legend-dot activity"></span>
            <span class="legend-text">Kulüp Etkinlikleri</span>
        </div>
        <div class="legend-item">
            <span class="legend-dot announcement"></span>
            <span class="legend-text">Duyurular</span>
        </div>
        <div class="legend-item">
            <span class="legend-dot academic"></span>
            <span class="legend-text">Akademik Olaylar</span>
        </div>
    </div>

    <!-- Takvim Grid -->
    <div class="calendar-wrapper">
        <!-- Gün İsimleri -->
        <div class="weekdays">
            <div class="weekday">Pzt</div>
            <div class="weekday">Sal</div>
            <div class="weekday">Çar</div>
            <div class="weekday">Per</div>
            <div class="weekday">Cum</div>
            <div class="weekday">Cmt</div>
            <div class="weekday">Paz</div>
        </div>

        <!-- Takvim Günleri (Dinamik) -->
        <div class="calendar-grid">
            @foreach (var day in calendarDays)
            {
                <div class="day @(day.IsOtherMonth ? "other-month" : "") @(day.IsToday ? "today" : "")">
                    <span class="day-number">@day.Day</span>
                    @if (day.HasEvents)
                    {
                        <div class="event-indicators">
                            @if (day.HasActivity)
                            {
                                <span class="event-dot activity"></span>
                            }
                            @if (day.HasAnnouncement)
                            {
                                <span class="event-dot announcement"></span>
                            }
                            @if (day.HasAcademic)
                            {
                                <span class="event-dot academic"></span>
                            }
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>

@code {
    private DateTime currentDate = DateTime.Now;
    private List<CalendarDay> calendarDays = new();

    protected override void OnInitialized()
    {
        GenerateCalendar();
    }

    private void PreviousMonth()
    {
        currentDate = currentDate.AddMonths(-1);
        GenerateCalendar();
    }

    private void NextMonth()
    {
        currentDate = currentDate.AddMonths(1);
        GenerateCalendar();
    }

    private void GenerateCalendar()
    {
        calendarDays.Clear();
        
        var firstDayOfMonth = new DateTime(currentDate.Year, currentDate.Month, 1);
        var lastDayOfMonth = firstDayOfMonth.AddMonths(1).AddDays(-1);
        
        // Pazartesi = 1, Pazar = 0 (DayOfWeek enum'unda Pazar = 0)
        int firstDayOfWeek = (int)firstDayOfMonth.DayOfWeek;
        if (firstDayOfWeek == 0) firstDayOfWeek = 7; // Pazar'ı 7 yap
        
        // Önceki aydan kaç gün göstereceğiz
        int daysFromPrevMonth = firstDayOfWeek - 1;
        
        // Önceki ayın günlerini ekle
        var prevMonthStart = firstDayOfMonth.AddDays(-daysFromPrevMonth);
        for (int i = 0; i < daysFromPrevMonth; i++)
        {
            var date = prevMonthStart.AddDays(i);
            calendarDays.Add(new CalendarDay
            {
                Date = date,
                Day = date.Day,
                IsOtherMonth = true,
                IsToday = false
            });
        }
        
        // Bu ayın günlerini ekle
        for (int day = 1; day <= lastDayOfMonth.Day; day++)
        {
            var date = new DateTime(currentDate.Year, currentDate.Month, day);
            calendarDays.Add(new CalendarDay
            {
                Date = date,
                Day = day,
                IsOtherMonth = false,
                IsToday = date.Date == DateTime.Today
            });
        }
        
        // Sonraki aydan günler ekle (toplam 35 veya 42 gün olacak şekilde)
        int totalDays = calendarDays.Count;
        int daysToAdd = totalDays <= 35 ? 35 - totalDays : 42 - totalDays;
        
        for (int i = 1; i <= daysToAdd; i++)
        {
            var date = lastDayOfMonth.AddDays(i);
            calendarDays.Add(new CalendarDay
            {
                Date = date,
                Day = date.Day,
                IsOtherMonth = true,
                IsToday = false
            });
        }
    }

    private class CalendarDay
    {
        public DateTime Date { get; set; }
        public int Day { get; set; }
        public bool IsOtherMonth { get; set; }
        public bool IsToday { get; set; }
        
        // Etkinlik göstergeleri (şimdilik örnek, ileride API'den gelecek)
        public bool HasActivity => false;
        public bool HasAnnouncement => false;
        public bool HasAcademic => false;
        public bool HasEvents => HasActivity || HasAnnouncement || HasAcademic;
    }
}
